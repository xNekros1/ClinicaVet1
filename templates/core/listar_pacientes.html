{% extends 'core/panel.html' %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h3 class="mb-1">Gestión de Pacientes</h3>
    <p class="text-muted mb-0">Administra las mascotas registradas</p>
  </div>

  {% if user.rol == "ADMIN" or user.rol == "RECEPCIONISTA" %}
  <a href="{% url 'crear_paciente' %}" class="btn btn-primary btn-lg rounded-pill">
    <i class="bi bi-plus-circle me-2"></i> Registrar Nuevo Paciente
  </a>
  {% endif %}
</div>

<div class="card border-0 shadow rounded-3">
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th class="ps-4">Paciente</th>
            <th>Especie</th>
            <th>Raza</th>
            <th>Tutor</th>
            <th class="text-end pe-4">Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for paciente in pacientes %}
          <tr>
            <td class="ps-4">
              <div class="d-flex align-items-center">
                <div
                  class="avatar-circle {% if paciente.especie == 'CANINO' %}bg-warning{% elif paciente.especie == 'FELINO' %}bg-info{% else %}bg-secondary{% endif %} text-white rounded-circle d-flex align-items-center justify-content-center me-3"
                  style="width: 40px; height: 40px;">
                  <i
                    class="bi bi-{% if paciente.especie == 'CANINO' %}dog{% elif paciente.especie == 'FELINO' %}cat{% else %}heart{% endif %}"></i>
                </div>
                <div>
                  <strong>{{ paciente.nombre }}</strong>
                  {% if paciente.sexo %}
                  <br>
                  <small class="text-muted">{{ paciente.get_sexo_display }} •
                    {% if paciente.fecha_nacimiento %}
                    {{ paciente.fecha_nacimiento|timesince }} de edad
                    {% else %}
                    Edad no especificada
                    {% endif %}
                  </small>
                  {% endif %}
                </div>
              </div>
            </td>
            <td>
              <span
                class="badge {% if paciente.especie == 'CANINO' %}bg-warning{% elif paciente.especie == 'FELINO' %}bg-info{% else %}bg-secondary{% endif %} rounded-pill">
                {{ paciente.get_especie_display }}
              </span>
            </td>
            <td>
              {{ paciente.raza|default:"N/A" }}
            </td>
            <td>
              <div class="d-flex align-items-center">
                <i class="bi bi-person text-primary me-2"></i>
                {{ paciente.tutor }}
              </div>
            </td>
            <td class="text-end pe-4">
              <div class="btn-group" role="group">
                <a href="{% url 'ficha_medica' paciente.id %}" class="btn btn-outline-info btn-sm rounded-pill me-1"
                  title="Ver Ficha Médica">
                  <i class="bi bi-file-medical"></i> Ficha
                </a>
                {% if user.rol == "ADMIN" or user.rol == "RECEPCIONISTA" %}
                <a href="{% url 'editar_paciente' paciente.id %}"
                  class="btn btn-outline-primary btn-sm rounded-pill me-1">
                  <i class="bi bi-pencil"></i> Editar
                </a>
                <a href="{% url 'eliminar_paciente' paciente.id %}" class="btn btn-outline-danger btn-sm rounded-pill">
                  <i class="bi bi-trash"></i> Eliminar
                </a>
                {% endif %}
              </div>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="5" class="text-center py-5">
              <i class="bi bi-heart-pulse display-4 text-muted d-block mb-3"></i>
              <h5 class="text-muted">No hay pacientes registrados</h5>
              <p class="text-muted">Comienza registrando el primer paciente</p>
              {% if user.rol == "ADMIN" or user.rol == "RECEPCIONISTA" %}
              <a href="{% url 'crear_paciente' %}" class="btn btn-primary rounded-pill mt-2">
                <i class="bi bi-plus-circle me-2"></i> Registrar Paciente
              </a>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}