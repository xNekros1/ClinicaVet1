{% extends 'core/panel.html' %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h3 class="mb-1">Reportes de Consultas</h3>
    <p class="text-muted mb-0">Genera reportes de ingresos por rango de fechas y pacientes</p>
  </div>
</div>

<!-- Filtros -->
<div class="card border-0 shadow rounded-3 mb-4">
  <div class="card-body p-4">
    <form method="GET" class="row g-3 align-items-end">
      <div class="col-md-3">
        <label for="{{ form.fecha_inicio.id_for_label }}" class="form-label fw-semibold">Fecha Inicio</label>
        {{ form.fecha_inicio }}
      </div>
      <div class="col-md-3">
        <label for="{{ form.fecha_fin.id_for_label }}" class="form-label fw-semibold">Fecha Fin</label>
        {{ form.fecha_fin }}
      </div>
      <div class="col-md-4">
        <label for="{{ form.paciente.id_for_label }}" class="form-label fw-semibold">Paciente (Opcional)</label>
        {{ form.paciente }}
      </div>
      <div class="col-md-2">
        <button type="submit" class="btn btn-primary w-100 rounded-pill">
          <i class="bi bi-search me-2"></i> Generar
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Resultados -->
{% if citas %}
<div class="card border-0 shadow rounded-3">
  <div class="card-header bg-white py-3 border-0">
    <div class="d-flex justify-content-between align-items-center">
      <h5 class="mb-0 fw-bold text-primary">Resultados del Reporte</h5>
      <div class="bg-success bg-opacity-10 text-success px-3 py-2 rounded-pill">
        <span class="fw-bold me-2">Total Ingresos:</span>
        <span class="fs-5 fw-bold">${{ total_ingresos | floatformat:0 }}</span>
      </div>
    </div>
  </div>
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th class="ps-4">Fecha</th>
            <th>Paciente</th>
            <th>Tutor</th>
            <th>Veterinario</th>
            <th>Tipo Pago</th>
            <th class="text-end pe-4">Monto</th>
          </tr>
        </thead>
        <tbody>
          {% for cita in citas %}
          <tr>
            <td class="ps-4 fw-bold">
              {{ cita.fecha_hora|date:"d/m/Y H:i" }}
            </td>
            <td>
              {{ cita.paciente.nombre }}
            </td>
            <td>
              {{ cita.paciente.tutor.nombre }} {{ cita.paciente.tutor.apellido }}
            </td>
            <td>
              {{ cita.veterinario }}
            </td>
            <td>
              <span class="badge bg-light text-dark border">{{ cita.get_tipo_pago_display }}</span>
            </td>
            <td class="text-end pe-4 fw-bold text-success">
              ${{ cita.monto|floatformat:0 }}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% elif request.GET.fecha_inicio %}
<div class="alert alert-info border-0 shadow-sm rounded-3 text-center py-5">
  <i class="bi bi-info-circle display-4 text-info d-block mb-3"></i>
  <h5>No se encontraron resultados</h5>
  <p class="mb-0">Intente con otro rango de fechas o filtros.</p>
</div>
{% else %}
<div class="text-center py-5 text-muted">
  <i class="bi bi-bar-chart-line display-1 d-block mb-3 opacity-25"></i>
  <h5>Seleccione filtros para generar un reporte</h5>
</div>
{% endif %}

<style>
  .form-control,
  .form-select {
    border-radius: 0.5rem;
    border: 1px solid #dee2e6;
  }

  .form-control:focus,
  .form-select:focus {
    border-color: #0d6efd;
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.15);
  }
</style>
{% endblock %}